<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="{{ url_for('static', path='assets/imgs/theme/FSH-Browser-Logo.jpeg') }}"
    />
    <title>{% block title %}{% endblock %} - Web</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', path='assets/css/main.css') }}?v=5.6"
    />
    <!-- Custom CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', path='assets/css/plugins/animate.min.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', path='assets/css/main.css') }}?v=1.1"
    />

    <!-- Custom Site CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', path='assets/css/site.css') }}"
    />

    <!-- Font Awesome kit -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
      integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Boostrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"
    />

    <!-- Toastr -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
    />

    <!-- Chat CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', path='assets/css/chat/chat.css') }}"
    />
  </head>

  <body>
    <!-- Start header -->
    <header class="header-area header-style-1 header-height-2">
      <div class="mobile-promotion">
        <span>Share More, Waste Less</span>
      </div>
      <div class="header-middle header-middle-ptb-1 d-none d-lg-block">
        <div class="container">
          <div class="header-wrap">
            <div class="logo logo-width-1">
              <!-- logo-width-1 -->
              <a href="/" class=""
                ><img
                  style="border: 100px"
                  src="{{ url_for('static', path='assets/imgs/theme/FSH4-Logo.png') }}"
                  alt="logo"
              /></a>
            </div>
            <div class="header-right">
              <div class="search-style-2">
                <div id="search" class="form">
                  <select id="searchCategory" class="select-active">
                    <option>All Categories</option>
                    <option>Milks & Dairies</option>
                    <option>Fresh Fruits</option>
                    <option>Vegetables</option>
                    <option>Wine & Drinks</option>
                    <option>Baking Material</option>
                    <option>Pet Foods</option>
                    <option>Noodles & Rice</option>
                    <option>Snacks</option>
                    <option>Others</option>
                  </select>
                  <input
                    id="searchInput"
                    type="text"
                    placeholder="Search for items..."
                  />
                </div>
              </div>
              <div class="header-action">
                <div class="header-action-2">
                  
                  <!--<form>
                      
                      <select class="select-active" >
                        
                      </select>
                      
                    </form>-->
                  <div class="mb-4" id="curent_location_section">
                    <i class="bi bi-geo-alt fa-lg"></i>
                    <label class="form-label" for="current_location"
                      >Current Location</label
                    >

                    <input
                      placeholder=""
                      value="Singapore"
                      type="text"
                      class="form-control"
                      id="current_location"
                      name="current_location"
                    />
                    
                    <div
                      id="currentaddressSuggestionCard"
                      class="card mt-10"
                      style="
                        display: none;
                        position: absolute;
                        z-index: 100;
                        width: 300px;
                      "
                    >
                      <div class="card-header">Suggestions</div>
                      <div
                        class="card-body"
                        style="overflow-y: auto; height: 350px"
                      >
                        <ul id="currentaddressSuggestionListItem"></ul>
                      </div>
                    </div>
                    <span for="current_location" class="text-danger"></span>
                  </div>

              
                  &nbsp;
                  
                  <!--<div class="header-action-icon-2">
                    <span >
                      <i class="bi bi-bell fa-lg position-relative " data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false"></i>
                      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">99+<span class="visually-hidden">unread messages</span>
                    </span>
                    
                    
                    <ul class="dropdown-menu dropdown-menu-lg-end" style="transition:1s ease;">
                      <li><button class="dropdown-item" type="button"> <i class="bi bi-x"></i></button></li>
                      <li><button class="dropdown-item" type="button">Another action</button></li>
                      <li><button class="dropdown-item" type="button">Something else here</button></li>
                    </ul>
                   
                  </div>-->
                  
                  
                  <!--<div
                      id="currentaddressSuggestionCard"
                      class="card mt-10"
                      style="position: relative; z-index: 100; width: 300px;left:0px;"
                    >
                      <div class="card-header">Suggestions</div>
                      <div
                        class="card-body"
                        style="overflow-y: auto; height: 350px"
                      >
                        <ul id="currentaddressSuggestionListItem"></ul>
                      </div>
                    </div>-->
                  &nbsp;
                  <div class="header-action-icon-2">
                    {% if request.session["session"] %} {% if
                    request.session["session"]["role"] %}
                    <a>
                      <img
                        id="user_image"
                        style="width: 30px; height: 30px"
                        src=""
                      />
                      <p id="user_image_name" hidden>
                        {{request.session["session"]["image"]}}
                      </p>
                    </a>
                    <a href="#" 
                      ><span class="lable ml-0" id="current_username"
                        >{{request.session["session"]["username"]}}</span
                      ></a
                    >

                    {% endif %}
                    <div
                      class="cart-dropdown-wrap cart-dropdown-hm2 account-dropdown"
                    >
                      <ul>
                        <li>
                          <a href="/user/account"
                            ><i class="fi fi-rs-user mr-10"></i>My Account</a
                          >
                        </li>
                        <li>
                          <a href="#"
                            ><i class="fi fi-rs-settings-sliders mr-10"></i
                            >Setting</a
                          >
                        </li>
                        {% if request.session["session"] %}
                        <li>
                          <form
                            method="POST"
                            action="/logout"
                            onsubmit="logout()"
                          >
                            <button class="btn btn-primary" type="submit">
                              <i class="fi fi-rs-sign-out mr-10"></i>Sign out
                            </button>
                          </form>
                        </li>
                        {% endif %}
                      </ul>
                    </div>
                    {% else %}
                    <a href="/login">
                      <span class="lable ml-0">Login</span>
                    </a>
                    {% endif %}
                  </div>
                  <div class="dropdown">
                    <div class="header-action-icon-2">
                        <a class="cart-icon position-relative" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                            <img alt="Notifications" src="{{ url_for('static', path='assets/imgs/theme/icons/icon-notifications.svg') }}" />
                            <span class="pro-count blue">2</span>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                          <!--Notification List Here-->
                        </ul>
                    </div>
                  </div>
                
                </div>
                </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="header-bottom header-bottom-bg-color sticky-bar">
        <div class="container">
          <div class="header-wrap header-space-between position-relative">
            <div class="logo logo-width-1 d-block d-lg-none">
              <a href="/"
                ><img
                  src="{{ url_for('static', path='assets/imgs/theme/FSH4-Logo.png') }}"
                  alt="logo"
              /></a>
            </div>

            <div class="header-nav d-none d-lg-flex">
              <div class="main-categori-wrap d-none d-lg-block">
                <a class="categories-button-active" href="#">
                  <span class="fi-rs-apps"></span>
                  <span class="et">Browse</span> All Categories
                  <i class="fi-rs-angle-down"></i>
                </a>
                <div
                  class="categories-dropdown-wrap categories-dropdown-active-large font-heading"
                >
                  <div class="d-flex categori-dropdown-inner">
                    <ul>
                      <li>
                        <a onclick="performSearchByCategory('Milks & Dairies')"
                          ><img
                            src="{{ url_for('static', path='assets/imgs/theme/icons/category-1.svg') }}"
                            alt=""
                          />Milks & Dairies</a
                        >
                      </li>
                      <li>
                        <a onclick="performSearchByCategory('Vegetables')"
                          ><img
                            src="{{ url_for('static', path='assets/imgs/theme/icons/category-8.svg') }}"
                            alt=""
                          />Vegetables</a
                        >
                      </li>
                      <li>
                        <a onclick="performSearchByCategory('Baking Material')"
                          ><img
                            src="{{ url_for('static', path='assets/imgs/theme/icons/category-1.svg') }}"
                            alt=""
                          />Baking Material</a
                        >
                      </li>
                      <li>
                        <a onclick="performSearchByCategory('Noodles & Rice')"
                          ><img
                            src="{{ url_for('static', path='assets/imgs/theme/icons/category-9.svg') }}"
                            alt=""
                          />Noodles & Rice</a
                        >
                      </li>
                      <li>
                        <a onclick="performSearchByCategory('Others')"
                          ><img
                            src="{{ url_for('static', path='assets/imgs/theme/icons/icon-4.svg') }}"
                            alt=""
                          />Others</a
                        >
                      </li>
                    </ul>
                    <ul class="end">
                      <li>
                        <a onclick="performSearchByCategory('Fresh Fruits')"
                          ><img
                            src="{{ url_for('static', path='assets/imgs/theme/icons/category-7.svg') }}"
                            alt=""
                          />Fresh Fruits</a
                        >
                      </li>
                      <li>
                        <a onclick="performSearchByCategory('Wine & Drinks')"
                          ><img
                            src="{{ url_for('static', path='assets/imgs/theme/icons/category-2.svg') }}"
                            alt=""
                          />Wine & Drinks</a
                        >
                      </li>
                      <li>
                        <a onclick="performSearchByCategory('Pet Foods')"
                          ><img
                            src="{{ url_for('static', path='assets/imgs/theme/icons/category-4.svg') }}"
                            alt=""
                          />Pet Foods</a
                        >
                      </li>
                      <li>
                        <a onclick="performSearchByCategory('Snacks')"
                          ><img
                            src="{{ url_for('static', path='assets/imgs/theme/icons/category-5.svg') }}"
                            alt=""
                          />Snacks</a
                        >
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <div
                class="main-menu main-menu-padding-1 main-menu-lh-2 d-none d-lg-block font-heading"
              >
                <nav>
                  <ul>
                    <li class="hot-deals">
                      <img
                        src="{{ url_for('static', path='assets/imgs/theme/icons/icon-hot.svg') }}"
                        alt="hot deals"
                      />
                      <a href="/">Home</a>
                    </li>
                    <li>
                      <a>Food Share<i class="fi-rs-angle-down"></i></a>
                      <ul class="sub-menu">
                        <li>
                          <a href="{{ url_for('show_my_listings_page') }}"
                            >My Listings</a
                          >
                        </li>
                        <li>
                          <a href="{{ url_for('show_add_listing_form') }}"
                            >Add FoodItems</a
                          >
                        </li>
                      </ul>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>

            <div class="header-action-icon-2 d-block d-lg-none">
              <div class="burger-icon burger-icon-white">
                <span class="burger-icon-top"></span>
                <span class="burger-icon-mid"></span>
                <span class="burger-icon-bottom"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="mobile-header-active mobile-header-wrapper-style">
      <div class="mobile-header-wrapper-inner">
        <div class="mobile-header-top">
          <div class="mobile-header-logo">
            <a href="#"
              ><img
                src="{{ url_for('static', path='assets/imgs/theme/FSH4-Logo.png') }}"
                alt="logo"
            /></a>
          </div>
          <div
            class="mobile-menu-close close-style-wrap close-style-position-inherit"
          >
            <button class="close-style search-close">
              <i class="icon-top"></i>
              <i class="icon-bottom"></i>
            </button>
          </div>
        </div>
        <div class="mobile-header-content-area">
          <div class="mobile-search search-style-3 mobile-header-border">
            <form action="#">
              <input type="text" placeholder="Search for items…" />
              <button type="submit"><i class="fi-rs-search"></i></button>
            </form>
          </div>
          <div class="mobile-menu-wrap mobile-header-border">
            <!-- mobile menu start -->
            <nav>
              <ul class="mobile-menu font-heading">
                <li class="menu-item-has-children">
                  <a href="/">Home</a>
                </li>
                <li class="menu-item-has-children">
                  <a href="#">Food Share</a>
                  <ul class="dropdown">
                    <li>
                      <a href="{{ url_for('show_my_listings_page') }}"
                        >My Listings</a
                      >
                    </li>
                    <li>
                      <a href="{{ url_for('show_add_listing_form') }}"
                        >Add FoodItems</a
                      >
                    </li>
                  </ul>
                </li>
              </ul>
            </nav>
            <!-- mobile menu end -->
          </div>
          <div class="mobile-header-info-wrap">
            <div class="single-mobile-header-info">
              <a
                ><i class="fi-rs-marker"></i> 180 Ang Mo Kio Ave 8, Singapore
                569830
              </a>
            </div>
            <div class="single-mobile-header-info">
              <a><i class="fi-rs-user"></i>Log In / Sign Up </a>
            </div>
            <div class="single-mobile-header-info">
              <a><i class="fi-rs-headphones"></i>(+65) - 8183 - 8227 </a>
            </div>
          </div>
          <div class="mobile-social-icon mb-50">
            <h6 class="mb-15">Follow Us</h6>
            <a
              ><img
                src="{{ url_for('static', path='assets/imgs/theme/icons/icon-facebook-white.svg') }}"
                alt=""
            /></a>
            <a
              ><img
                src="{{ url_for('static', path='assets/imgs/theme/icons/icon-twitter-white.svg') }}"
                alt=""
            /></a>
            <a
              ><img
                src="{{ url_for('static', path='assets/imgs/theme/icons/icon-instagram-white.svg') }}"
                alt=""
            /></a>
            <a
              ><img
                src="{{ url_for('static', path='assets/imgs/theme/icons/icon-pinterest-white.svg') }}"
                alt=""
            /></a>
            <a
              ><img
                src="{{ url_for('static', path='assets/imgs/theme/icons/icon-youtube-white.svg') }}"
                alt=""
            /></a>
          </div>
          <div class="site-copyright">
            Copyright 2024 © FoodShareHub. All rights reserved.
          </div>
        </div>
      </div>
    </div>
    <!--End header-->

    <div class="container">
      {% for message in get_flashed_messages() %} {% if message.category and
      message.category.strip() %}
      <div
        class="alert alert-{{ message.category }} alert-dismissible fade show"
        role="alert"
      >
        <strong>{{ message.message }}</strong>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      {% endif %} {% endfor %}
      <!-- Alert Modal -->
      <div id="alertModal" class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="alertModalLabel"></h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body" id="alertModalBody">
              <!-- Message content will be inserted here -->
            </div>
          </div>
        </div>
      </div>
    </div>
    <div>{% block content %} {% endblock %}</div>
    <hr />

    <footer class="main">
      <section class="section-padding footer-mid">
        <div class="container pt-15 pb-20">
          <div class="row">
            <div class="col">
              <div class="widget-about font-md mb-md-3 mb-lg-3 mb-xl-0">
                <div class="logo mb-30">
                  <a href="#" class="mb-15"
                    ><img
                      src="{{ url_for('static', path='assets/imgs/theme/FSH4-Logo.png') }}"
                      alt="logo"
                  /></a>
                  <p class="font-lg text-heading">Share More, Waste Less</p>
                </div>
                <ul class="contact-infor">
                  <li>
                    <img
                      src="{{ url_for('static', path='assets/imgs/theme/icons/icon-location.svg') }}"
                      alt=""
                    /><strong>Address:</strong>
                    <span>180 Ang Mo Kio Ave 8, Singapore 569830</span>
                  </li>
                  <li>
                    <img
                      src="{{ url_for('static', path='assets/imgs/theme/icons/icon-contact.svg') }}"
                      alt=""
                    /><strong>Call Us:</strong> <span>(+65) - 8183-8227</span>
                  </li>
                  <li>
                    <img
                      src="{{ url_for('static', path='assets/imgs/theme/icons/icon-email-2.svg') }}"
                      alt=""
                    /><strong>Email:</strong>
                    <span>support@FoodShareHub.com</span>
                  </li>
                </ul>
              </div>
            </div>
            <div class="footer-link-widget col">
              <h4 class="widget-title">Company</h4>
              <ul class="footer-list mb-sm-5 mb-md-0">
                <li><a>About Us</a></li>
                <li><a>Privacy Policy</a></li>
                <li><a>Terms &amp; Conditions</a></li>
                <li><a>Contact Us</a></li>
              </ul>
            </div>
            <div class="footer-link-widget col">
              <h4 class="widget-title">Account</h4>
              <ul class="footer-list mb-sm-5 mb-md-0">
                <li><a>Sign In</a></li>
                <li><a>Sign Up</a></li>
              </ul>
            </div>
          </div>
        </div>
      </section>
      <div class="container pb-30">
        <div class="row align-items-center">
          <div class="col-12 mb-30">
            <div class="footer-bottom"></div>
          </div>
          <div class="col-xl-4 col-lg-6 col-md-6">
            <p class="font-sm mb-0">
              &copy; 2023, <strong class="text-brand">FoodShareHub</strong> - A
              Food Sharing Platform <br />All rights reserved
            </p>
          </div>
          <div class="col-xl-4 col-lg-6 text-center d-none d-xl-block"></div>
          <div class="col-xl-4 col-lg-6 col-md-6 text-end d-none d-md-block">
            <div class="mobile-social-icon">
              <h6>Follow Us</h6>
              <a
                ><img
                  src="{{ url_for('static', path='assets/imgs/theme/icons/icon-facebook-white.svg') }}"
                  alt=""
              /></a>
              <a
                ><img
                  src="{{ url_for('static', path='assets/imgs/theme/icons/icon-twitter-white.svg') }}"
                  alt=""
              /></a>
              <a
                ><img
                  src="{{ url_for('static', path='assets/imgs/theme/icons/icon-instagram-white.svg') }}"
                  alt=""
              /></a>
              <a
                ><img
                  src="{{ url_for('static', path='assets/imgs/theme/icons/icon-pinterest-white.svg') }}"
                  alt=""
              /></a>
              <a
                ><img
                  src="{{ url_for('static', path='assets/imgs/theme/icons/icon-youtube-white.svg') }}"
                  alt=""
              /></a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Preloader Start -->
    <div id="loadingDiv" style="display: none">
      <div class="preloader d-flex align-items-center justify-content-center">
        <div class="preloader-inner position-relative">
          <div class="text-center">
            <img
              src="{{ url_for('static', path='assets/imgs/theme/loading-transparent.gif') }}"
              alt=""
            />
          </div>
        </div>
      </div>
    </div>

    {% block scripts %}
    <!-- Vendor JS -->
    <script src="{{ url_for('static', path='assets/js/vendor/modernizr-3.6.0.min.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/vendor/jquery-3.6.0.min.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/vendor/jquery-migrate-3.3.0.min.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/vendor/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/slick.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/wow.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/perfect-scrollbar.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/magnific-popup.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/select2.min.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/waypoints.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/counterup.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/images-loaded.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/isotope.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/scrollup.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/jquery.syotimer.min.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/jquery.countdown.min.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/jquery.vticker-min.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/jquery.theia.sticky.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/plugins/jquery.elevatezoom.js') }}"></script>

    <!-- Template  JS -->
    <script src="{{ url_for('static', path='assets/js/main.js') }}?v=5.6"></script>
    <script src="{{ url_for('static', path='assets/js/shop.js') }}?v=5.6"></script>

    <!-- Toastr JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- DOMPurify -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2/dist/purify.min.js"></script>

    <!-- Chat JS -->
    <script src="{{ url_for('static', path='assets/js/chat/chat.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/chat/textarea.js') }}"></script>
    <script src="{{ url_for('static', path='assets/js/chat/time.js') }}"></script>

    <!-- Captcha Script-->
    <script src="https://www.google.com/recaptcha/api.js"></script>

    <script>
  
      document
        .getElementById("current_location")
        .addEventListener("input", function () {
         

          var controller = new AbortController(); // Create a new controller for the current request

          var searchQuery = document.getElementById("current_location").value;

          if (searchQuery.length == 0) {
            // Hide the suggestion card and stop the process if searchQuery's length is 0
            const suggestionCard = document.getElementById(
              "currentaddressSuggestionCard"
            );
            suggestionCard.style.display = "none";
            return;
          }

          fetch(`/foodshare/autocomplete/${searchQuery}`, {
            signal: controller.signal,
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.suggestions) {
                // Display the suggestion card
                const suggestionCard = document.getElementById(
                  "currentaddressSuggestionCard"
                );
                suggestionCard.style.display = "";

                displaySuggestions(data.suggestions, handleSuggestionClick);
              } else {
                // Hide the sugesstion card if no suggeestion return
                const suggestionCard = document.getElementById(
                  "currentaddressSuggestionCard"
                );
                suggestionCard.style.display = "none";
              }
            })
            .catch((error) => {
              if (error.name === "AbortError") {
                // Request was aborted, ignore
              } else {
                console.error("Error:", error);
              }
            });
        });

      function displaySuggestions(suggestions, clickHandler) {
        const suggestionsList = document.getElementById(
          "currentaddressSuggestionListItem"
        );
        suggestionsList.innerHTML = "";

        if (suggestions.length === 0) {
          return;
        }

        suggestions.forEach((suggestion) => {
          const li = document.createElement("li");
          li.innerHTML =
            "<p style='white-space: normal;'>" + suggestion + "</p>";
          // Bind the click handler to each list item.
          li.addEventListener("click", clickHandler);
          li.classList.add("dropdown-item");
          suggestionsList.appendChild(li);
        });
      }

      function handleSuggestionClick(event) {
        if (event.target.tagName === "LI") {
          // Set the address text
          const pickupLocationInput =
            document.getElementById("current_location");
          pickupLocationInput.value = event.target.textContent;
          // currentLocation = pickupLocationInput.value;
          UserCurrentLocation = pickupLocationInput.value;
          filteritems(filter_type);

          // Hide address suggestion card
          const addressSuggestionCard = document.getElementById(
            "currentaddressSuggestionCard"
          );
          addressSuggestionCard.style.display = "none";
        }
      }

      // For captcha TO DO LATER
      function onSubmit(token) {
        document.getElementById("signin_form").submit();
      }

      // For list of recommended_products
      var index_recommended_products = [];
      // Default user location value
      var UserCurrentLocation = "Singapore"
      var input_current_location = document.getElementById("current_location");
      input_current_location.value = UserCurrentLocation
      // For current filter type by default is bicycle
      var filter_type = "Bicycle";

      // get donations in / path
      function getDonations() {
        fetch("/getdonations", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            const recommended_products_section = document.getElementById(
              "recommended_products_section"
            );

            data["donations"].forEach((item) => {
              index_recommended_products.push(item);
              recommended_products_section.innerHTML += `
                <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                  <div class="product-cart-wrap mb-30">
                      <div class="product-img-action-wrap">
                          <div class="product-img product-img-zoom">
                              <a href="shop-product-right.html">
                                  <img class="default-img" src="${
                                    item["Image"]
                                  }" alt="" />
                                  <img class="hover-img" src="{{ url_for('static', path='assets/imgs/shop/product-1-2.jpg') }}" alt="" />
                              </a>
                          </div>
                          
                          <div class="product-badges product-badges-position product-badges-mrg">
                              <span class="hot">Hot</span>
                          </div>
                      </div>
                      <div class="product-content-wrap">
                          <div class="product-category">
                              <a href="shop-grid-right.html">${
                                item["Category"]
                              }</a>
                          </div>
                          <h2><a href="shop-product-right.html">${
                            item["Name"]
                          }</a></h2>
                          <div>
                              <span class="font-small text-muted">By <a href="vendor-details-1.html">Food Share Hub</a></span>
                          </div>
                          <hr>
                          <div class="row">
                            <div class="col-9">
                              <marquee direction="right" class="font-small text-muted" id="location_${data[
                                "donations"
                              ]
                                .indexOf(item)
                                .toString()}">${
                item["MeetUpLocation"]
              }</marquee>
                            </div>
                            <div class="col-3">
                              <span style="float:right;" id="distance_${data[
                                "donations"
                              ]
                                .indexOf(item)
                                .toString()}"></span>
                            </div>

                          </div>
                          <hr>
                          <div style="text-align:center;" id="bicycle_${data[
                            "donations"
                          ]
                            .indexOf(item)
                            .toString()}">
                              <i class="bi bi-bicycle fa-lg"></i>&nbsp;<span class="font-small text-muted" id="bicycle_time_${data[
                                "donations"
                              ]
                                .indexOf(item)
                                .toString()}"></span>
                          </div>
                          <div style="text-align:center;display:none;" id="walk_${data[
                            "donations"
                          ]
                            .indexOf(item)
                            .toString()}" >
                              <i class="bi bi-person-walking fa-lg"></i>&nbsp;<span class="font-small text-muted" id="walk_time_${data[
                                "donations"
                              ]
                                .indexOf(item)
                                .toString()}"></span>
                          </div>
                          <div style="text-align:center;display:none;" id="car_${data[
                            "donations"
                          ]
                            .indexOf(item)
                            .toString()}" >
                              <i class="bi bi-car-front-fill fa-lg"></i>&nbsp;<span class="font-small text-muted" id="car_time_${data[
                                "donations"
                              ]
                                .indexOf(item)
                                .toString()}"></span>
                          </div>

                      </div>
                  </div>
                </div>
              `;
            });

            // Filter Recommended Products
            filteritems(filter_type);
          });
      }

      function filteritems(product_filter) {
        filter_type = product_filter;
        var list_of_locations = [];
        for (var i = 0; i < index_recommended_products.length; i++) {
          var targetLocation = document.getElementById(
            "location_" + i.toString()
          ).innerText;
          list_of_locations.push(targetLocation);
        }

        const locationData = {
          TargetLocation: list_of_locations,
          CurrentLocation: UserCurrentLocation,
          FilterType: filter_type,
        };
        // fetch for items location & distances
        fetch("/filteritems", {
          method: "POST",
          body: JSON.stringify(locationData),
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            // Need to loop through here once have alot of items
            for (var i = 0; i < index_recommended_products.length; i++) {
              var distance = document.getElementById(
                "distance_" + i.toString()
              );
              if (filter_type == "Bicycle") {
                console.log("bicycle")
                var bicycle_time = document.getElementById(
                  "bicycle_time_" + i.toString()
                );
                var bicycle = document.getElementById(
                  "bicycle_" + i.toString()
                );
                bicycle.style.display = "block";

                var car = document.getElementById("car_" + i.toString());
                car.style.display = "none";

                var walk = document.getElementById("walk_" + i.toString());
                walk.style.display = "none";

                distance.innerHTML = data.distance[i] + "km";
                bicycle_time.innerHTML = data.time[i];
              } else if (filter_type == "Walking") {
                console.log("walking")
                var walk_time = document.getElementById(
                  "walk_time_" + i.toString()
                );
                var bicycle = document.getElementById(
                  "bicycle_" + i.toString()
                );
                bicycle.style.display = "none";

                var car = document.getElementById("car_" + i.toString());
                car.style.display = "none";

                var walk = document.getElementById("walk_" + i.toString());
                walk.style.display = "block";

                distance.innerHTML = data.distance[i] + "km";
                walk_time.innerHTML = data.time[i];
              } else if (filter_type == "Car") {
                console.log("car")
                var car_time = document.getElementById(
                  "car_time_" + i.toString()
                );
                var bicycle = document.getElementById(
                  "bicycle_" + i.toString()
                );
                bicycle.style.display = "none";

                var car = document.getElementById("car_" + i.toString());
                car.style.display = "block";

                var walk = document.getElementById("walk_" + i.toString());
                walk.style.display = "none";

                distance.innerHTML = data.distance[i] + "km";
                car_time.innerHTML = data.time[i];
              }
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      function getUserCurrentLocation(){
        if ("geolocation" in navigator) {
          // Request access to the user's location
          navigator.geolocation.getCurrentPosition(
            function(position) {
              // Success callback
              var latitude = position.coords.latitude;
              var longitude = position.coords.longitude;
              console.log("Latitude: " + latitude + ", Longitude: " + longitude);
              
              // Singapore max & min of longitude and latitude
              const minLatitude = 1.09;
              const maxLatitude = 1.47;
              const minLongitude = 103.59;
              const maxLongitude = 104.09;
              
              if(latitude < minLatitude || latitude > maxLatitude && longitude < minLongitude || longitude > maxLongitude){
                console.log("Location not within Singapore");

              }else{
                const formData = {Longitude:longitude,Latitude:latitude}
                fetch("/getusercurrentlocation", {
                  method: "POST",
                  body: JSON.stringify(formData),
                  headers: {
                    "Content-Type": "application/json",
                  },
                })
                .then((response) => response.json())
                .then((data) => {
                  console.log(data.user_location);
                  var input_current_location = document.getElementById("current_location");
                  input_current_location.value = data.user_location
                  UserCurrentLocation = data.user_location
                })
              }
              
            },
            function(error) {
              // Error callback
              switch(error.code) {
                case error.PERMISSION_DENIED:
                  console.error("User denied the request for Geolocation.");
                  break;
                case error.POSITION_UNAVAILABLE:
                  console.error("Location information is unavailable.");
                  break;
                case error.TIMEOUT:
                  console.error("The request to get user location timed out.");
                  break;
                case error.UNKNOWN_ERROR:
                  console.error("An unknown error occurred.");
                  break;
              }
            }
          );
        } else {
          // Browser doesn't support geolocation
          console.error("Geolocation is not supported by this browser.");
        }
      }

      // Load after everything is loaded
      document.addEventListener('DOMContentLoaded', function() {
          // Profile image
          try {
            var user_image_name = document.getElementById("tempHolder");
            var user_image = document.getElementById("imagePreview");
            if (user_image_name.innerText === "N/A") {
              user_image.style.backgroundImage =
                "url(https://tse2.mm.bing.net/th?id=OIP.6UhgwprABi3-dz8Qs85FvwHaHa&pid=Api&P=0&h=180)";
            } else {
              user_image.style.backgroundImage = `url(${user_image_name.innerText})`;
            }
          } catch (error) {
            console.log(error);
          }
          try {
            var user_image_name = document.getElementById("user_image_name");
            var user_image = document.getElementById("user_image");
            user_image.src = user_image_name.innerText;
          } catch (error) {
            console.log(error);
          }

            // Check if current path = /
          if (window.location.pathname == "/") {
            getUserCurrentLocation();
            // Get Donations for Recommended Products
            getDonations();
          }


          // Fetch Notification Method
          var dropdownButton = document.getElementById('dropdownMenuButton');
          dropdownMenuButton.addEventListener('shown.bs.dropdown', function () {
              fetchNotifications();
          });
        });

      // Windows on load will run everything here
      window.onload = function () {
        if (window.location.pathname.startsWith("/chat/")) {
            var targetElement = document.getElementById("scrollHere");
            requestAnimationFrame(function() {
              targetElement.scrollIntoView({ behavior: 'smooth', block: 'end' });
            })
        }

        if(document.getElementById("receiverOnlineHeader")){
          
          var user_status = document.getElementById("receiverOnlineHeader");
          var user_status_icon = document.getElementById("user_status_icon");
          if(user_status.innerText == "Offline"){
            user_status_icon.style.backgroundColor = "Red"
          }else{
            user_status_icon.style.backgroundColor = "#70db70"
          }
        }
        
        // Google login
        try {
          const fragment = window.location.hash.substring(1);
          const access_token = new URLSearchParams(fragment).get(
            "access_token"
          );
          const formData = { Token: access_token };
          if (access_token) {
            fetch("/googlelogin", {
              method: "POST",
              body: JSON.stringify(formData),
              headers: {
                "Content-Type": "application/json",
              },
            })
              .then((response) => response.json())
              .then((data) => {
                
                window.location.href = data.redirect_url;
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          }
        } catch (error) {
          console.log(error);
        }

        

        // On load check for actions to be done in local storage
        try {
          // Hide loader
          loadingDiv.style.display = "none";

          var action = localStorage.getItem("action");
          // console.log(action);
          // Toast template to use
          const SuccessToast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 1500,
            timerProgressBar: true,
            didOpen: (toast) => {
              toast.onmouseenter = Swal.stopTimer;
              toast.onmouseleave = Swal.resumeTimer;
            },
          });
          // For successful login
          if (action === "success_login") {
            // console.log("trigger login toast");
            var login_user = document.getElementById("login_user").innerHTML;
            SuccessToast.fire({
              icon: "success",
              title: `Welcome back ${login_user}`,
            });
            localStorage.removeItem("action");
          }
          // For successful logout
          else if (action === "success_logout") {
            // console.log("trigger logout toast");
            SuccessToast.fire({
              icon: "success",
              title: "Logout Successfully",
            });
            localStorage.removeItem("action");
            // For signup confirmation
          } else if (action === "signup_confirmation") {
            // console.log("trigger signup confirmation toast");
            var email = localStorage.getItem("data");
            SuccessToast.fire({
              icon: "success",
              title: `A confirmation code has been sent to ${email}`,
            });
            localStorage.removeItem("action");
            localStorage.removeItem("data");
          } else if (action === "success_signup") {
            // console.log("success account activated toast");
            SuccessToast.fire({
              icon: "success",
              title: `Successfully activated account`,
            });
            localStorage.removeItem("action");
          } else if (action === "signup_error") {
            // console.log("signup error toast");
            var message = localStorage.getItem("data");
            SuccessToast.fire({
              icon: "error",
              title: message,
            });
            localStorage.removeItem("action");
          }
        } catch (error) {
          console.log(error);
        }
      };

      const loadingDiv = document.getElementById("loadingDiv");

      // Triggers logout action to store in local storage
      function logout() {
        // console.log("logout");
        localStorage.setItem("action", "success_logout");
      }

      // Set notification in local storage
      function setNotificationMessage(category, text) {
        const notificationObject = { category, text };
        localStorage.setItem(
          "notificationMessage",
          JSON.stringify(notificationObject)
        );
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Start: Toastr, Check if there is a notification message in local storage
        const storedNotification = JSON.parse(
          localStorage.getItem("notificationMessage")
        );

        if (storedNotification) {
          // Extract category and text from the stored object
          const { category, text } = storedNotification;

          // Display the notification message using Toastr based on the category
          if (category === "success") {
            toastr.success(text);
          } else if (category === "error") {
            toastr.error(text);
          } else if (category === "info") {
            toastr.info(text);
          }

          // Clear the notification message from local storage
          localStorage.removeItem("notificationMessage");
        }
        // End: Toastr, Check if there is a notification message in local storage

        // Start: Get URL parameters and populate the search box and category selected when the search results page loads
        const searchInput = document.getElementById("searchInput");
        const searchCategory = document.getElementById("searchCategory");
        const categoryRender = document.getElementById(
          "select2-searchCategory-container"
        );

        const searchCategoryFromUrl = getParameterByName("category");
        const searchInputFromUrl = getParameterByName("name");

        const decodedCategory = decodeURIComponent(searchCategoryFromUrl);
        const decodedSerchInput = decodeURIComponent(searchInputFromUrl);

        if (searchCategoryFromUrl) {
          searchCategory.value = decodedCategory;
          categoryRender.title = decodedCategory;
          categoryRender.textContent = decodedCategory;
        }
        if (searchInputFromUrl) {
          searchInput.value = decodedSerchInput;
        }
        // End: Get URL parameters and populate the search box and category selected when the search results page loads
      });

      // Add an event listener to trigger the search on pressing 'Enter'
      document
        .getElementById("searchInput")
        .addEventListener("keyup", function (event) {
          if (event.key === "Enter") {
            performSearch();
          }
        });

      // Perform search by using the search bar
      function performSearch() {
        const searchCategory = document.getElementById("searchCategory").value;
        const searchTerm = document.getElementById("searchInput").value;
        if (searchTerm != "") {
          // const loadingDiv = document.getElementById('loadingDiv');
          loadingDiv.style.display = "";

          const searchUrl = `/foodshare/search?category=${encodeURIComponent(
            searchCategory
          )}&name=${encodeURIComponent(searchTerm)}`;
          window.location.href = searchUrl;
        }
      }

      // Perform search by clicking the category
      function performSearchByCategory(category) {
        // const loadingDiv = document.getElementById('loadingDiv');
        loadingDiv.style.display = "";

        const searchUrl = `/foodshare/search?category=${encodeURIComponent(
          category
        )}`;
        window.location.href = searchUrl;
      }

      // Get URL Parameter
      function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, "\\$&");
        const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return "";
        return results[2].replace(/\+/g, " ");
      }

      
    </script>
    <script>
      // Get notification
      function fetchNotifications() {
        console.log("fetching notifications");
        fetch("/api/user/getNotifications", {
          method: "Get",
          headers: {
            "Content-Type": "application/json",
          },
        })
        .then(response => {
          if (!response.ok) {
              throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          console.log(data);
          populateNotificationDropdown(data);
        })
        .catch(error => {
          console.error('There has been a problem with your fetch operation:', error);
        });
      }

      function populateNotificationDropdown(notifications) {
          const dropdownMenu = document.querySelector('.header-action-icon-2 .dropdown-menu');
          dropdownMenu.innerHTML = ''; // Clear current notifications

          if (notifications.length === 0) {
              dropdownMenu.innerHTML = `
                  <li class="dropdown-item">
                      <div class="d-flex align-items-center">
                          <span>You do not have any unread notifications</span>
                      </div>
                  </li>
              `;
          } else {
              notifications.forEach(notification => {
                  console.log("notification", notification);

                  const ahrefItem = document.createElement('a');
                  ahrefItem.href = `/chat/${notification.username}`;
                  ahrefItem.innerHTML = `
                      <li class="d-flex align-items-center justify-content-between dropdown-item">
                          <div class="d-flex align-items-center">
                              <i class="fa-regular fa-message"></i>

                              <span>&nbsp; ${notification.message}</span>
                          </div>
                      </li>
                  `;
                  dropdownMenu.appendChild(ahrefItem);
              });
          }
      }
    </script>
    {% endblock %}
  </body>
</html>
